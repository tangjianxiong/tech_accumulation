---
title: 回调函数
subtitle: 学习记录
author: Allwinner
changelog:
- ver: 1.1
  date: 2019.9.19
  author: xxx 
  desc: |
		1.建立文档 
		2.修改xxx



---


# 函数的调用形式
软件模块之间总是存在着一定的接口，从调用方式上，可以把他们分为三类： 
同步调用、回调和异步调用。

## 同步调用
同步调用, 是一种阻塞式调用，调用方要等待对方执行完毕才返回，它是一种单向调用。
## 回调
回调,是一种双向调用模式，也就是说，被调用方在接口被调用时也会调用对方的接口。
## 异步调用
异步调用, 是一种类似消息或事件的机制，不过它的调用方向刚好相反，接口的服务在收到某种讯息或发生某种事件时，会主动通知客户端（即调用客户端的接口）。

## 小结
回调和异步调用的关系非常紧密，通常我们使用回调来实现异步消息的注册，通过异步调用来实现消息的通知。   
同步调用是三者当中最简单的，而回调又常常是异步调用的基础，因此，下面我们着重讨论回调机制在不同软件架构中的实现。  


对于不同类型的语言（如结构化语言和对象语言）、平台（Win32、JDK）或构架（CORBA、DCOM、WebService），客户和服务的交互除了同步方式以外，都需要具备一定的异步通知机制，让服务方（或接口提供方）在某些情况下能够主动通知客户，而回调是实现异步的一个最简捷的途径。  


对于一般的结构化语言，可以通过回调函数来实现回调。回调函数也是一个函数或过程，不过它是一个由调用方自己实现，供被调用方使用的特殊函数。  


在面向对象的语言中，回调则是通过接口或抽象类来实现的，我们把实现这种接口的类成为回调类，回调类的对象成为回调对象。 对于像C++或Object Pascal这些兼容了过程特性的对象语言，不仅提供了回调对象、回调方法等特性，也能兼容过程语言的回调函数机制。  


Windows平台的消息机制也可以看作是回调的一种应用，我们通过系统提供的接口注册消息处理函数（即回调函数），从而实现接收、处理消息的目的。由于Windows平台的API是用C语言来构建的，我们可以认为它也是回调函数的一个特例。  


对于分布式组件代理体系CORBA，异步处理有多种方式，如回调、事件服务、通知服务等。 
事件服务和通知服务是CORBA用来处理异步消息的标准服务，他们主要负责消息的处理、派发、维护等工作。 
对一些简单的异步处理过程，我们可以通过回调机制来实现。  

# C语言中的回调
## 函数指针
回调在C语言中是通过函数指针来实现的,通过将回调函数的地址传给被调函数从而实现回调。 
因此，要实现回调，必须首先定义函数指针，请看下面的例子：

```
void Func(char *s)；// 函数原型 
void (*pFunc) (char *);//函数指针 
```
可以看出，函数的定义和函数指针的定义非常类似。  
一般为了简化函数指针类型的变量定义，提高程序的可读性，我们需要把函数指针类型自定义一下。 

```
typedef void(*pcb)(char *); 
```

回调函数可以象普通函数一样被程序调用，但是只有它被当作参数传递给被调函数时才能称作回调函数。  


被调函数的例子： 

```
void GetCallBack(pcb callback) 
{ 
    /*do something*/ 
} 

```
用户在调用上面的函数时，需要自己实现一个pcb类型的回调函数： 

```
void fCallback(char *s)  
{ 
    /* do something */ 
}  
```
然后，就可以直接把fCallback当作一个变量传递给GetCallBack, 
```
GetCallBack(fCallback); 
```

## 参数传递规则
<https://blog.csdn.net/fireroll/article/details/79060297>